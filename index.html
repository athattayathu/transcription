<html>
<head>
	<title>realm.io</title>
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

	<!-- Latest compiled JavaScript -->
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</head>
<body class="container">
	<div class="row">
		<h1>realm</h1>
	</div>
	<div class="row">&nbsp;</div><!--space-->
	<div class="row">
		<video id="video" class="col-md-6 col-sm-6 col-xs-12" poster="" type="video/mp4" controls>
			<source id= "dasource" src="" type="video/mp4">
		</video>
		<div class="col-md-6 col-sm-6 col-xs-12 form-group">
		  <label for="comment">Times:</label>
		  <textarea class="form-control" rows="5" id="values" placeholder="Load a video with a URL above searching for wistia_23_source in the source of the video page."></textarea>
		</div>
		<!--</div>
		<div class="row">-->
		<script async class="speakerdeck-embed" data-id="13842e0f45854c048247284d95686b4e" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>
	</div>
	<!-- Trigger the modal with a button -->
<button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">Open Modal</button>

<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Video Details</h4>
      </div>
      <div class="modal-body">
			<div class="row">
				<div class="col-xs-12 input-group">
					<input placeholder="Video URL" type="text" class="form-control" id="videoUrl">
				</div>
			</div>
			<br/><!--space-->
			<div class="row">
				<div class="col-xs-12 input-group">
					<input placeholder="Video Title" type="text" class="form-control" id="title">
				</div>
			</div>
			<br/><!--space-->
			<div class = "row">
				<div class="col-xs-12 input-group">
					<input placeholder="Slide Deck Id" type="text" class="form-control" id="slideId">
				</div>
			</div>

      </div>
      <div class="modal-footer">
        <button class="btn btn-default" onclick="changeVideo()">Submit</button>
        
      </div>
    </div>

  </div>
</div>

</body>

<script>

var slideObj = {
						"url": ______,
						"time": _____
		         };


var obj = {
		  "title": _______,
		  "chapters": [
			   {
			      "title": _________,
			      "duration": ______,
			      "video": {
			        "url": __________
			      },
			      "slides": [
			      ]
			   }
   		]
   	};

var slideNum = 1;

var updateSlideNum(){
	slideNum = $('#slideNum').val();
	$('#slideNum').val(slideNum);
}

function changeVideo(){
	var url = $("#videoUrl").val();
	document.getElementById("dasource").setAttribute('src', url);
   video.load();
}

function keypressed(event){
	const KEY_RECORD_TIME = 16;//shift
	const KEY_REMOVE_LAST = 27;//escape
	const KEY_PLAY_PAUSE = 32; //space
	const KEY_REWIND = 37;//left arrow
	const KEY_FORWARD = 39;//right arrow

	if ($(event.target).is('input, textarea')) {
	// check to make sure the keypresses are not originating from a text area
     	return;   
   }


	var keycode;
   
   if (window.event)
        keycode = window.event.keyCode;
   else if (event)
        keycode = event.which;

   if(keycode === KEY_RECORD_TIME){

	   var source = {
					"url" : "https://speakerdeck.com/" + $('#slideId').val() + "#" + slideNum++,
					"time" : Math.trunc(document.getElementById("video").currentTime)
				 };
   	var vals = $("#values");
   	vals.val(vals.val() + JSON.stringify(source, null, "   ") + ",\n");
   	var textarea = document.getElementById("values");
   	textarea.scrollTop = textarea.scrollHeight;
   	updateSlideNum();

   } else if(keycode === KEY_REMOVE_LAST){

   	var vals = $("#values");
   	var arr = vals.val().split("\n");
   	arr.pop();
   	vals.val(arr.join("\n"));

   } else if(keycode === KEY_PLAY_PAUSE){
   	var video = document.getElementById("video");
   	if(video.paused){
   		video.play();
   	} else {
   		video.pause();
   	}

   } else if(keycode === KEY_REWIND){
   	document.getElementById("video").currentTime -= 1;

   } else if(keycode === KEY_FORWARD){
   	document.getElementById("video").currentTime += 1;
   }
}

function loadStart(event)
{
	$(document).unbind('keydown');//removes any previous handlers left over after refresh
   $(document).keydown(keypressed);
}

function init()
{
   var video = document.getElementById("video");
   video.addEventListener('loadedmetadata', loadStart, false);
   
}

document.addEventListener("DOMContentLoaded", init, false);


</script>
</html>